<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>multiverse</title>
<link>https://amenalahassa.github.io/amenalahassa/</link>
<atom:link href="https://amenalahassa.github.io/amenalahassa/index.xml" rel="self" type="application/rss+xml"/>
<description>A small space in the vast universe of the Internet where I share the ideas and knowledge I&#39;ve gained on my journey into AI and software development.</description>
<generator>quarto-1.5.37</generator>
<lastBuildDate>Sat, 24 Aug 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>How Much Memory Does Your Model Need on GPU? Letâ€™s Find Out!</title>
  <link>https://amenalahassa.github.io/amenalahassa/posts/model_gpu.html</link>
  <description><![CDATA[ 




<section id="a-tool-to-estimate-model-memory-usage-on-gpu" class="level1 page-columns page-full">
<h1>A Tool to Estimate Model Memory Usage on GPU</h1>
<p>Hey there, fellow developers and curious minds! ğŸ–– Ever wondered how much juice you need to run a model on your GPU? Whether youâ€™re knee-deep in code or just dipping your toes into the tech waters, the question of resources has likely crossed your mind.</p>
<section id="building-a-tool-to-estimate-gpu-memory-usage" class="level3">
<h3 class="anchored" data-anchor-id="building-a-tool-to-estimate-gpu-memory-usage">Building a Tool to Estimate GPU Memory Usage</h3>
<p>Guess what? I built a tool for that! ğŸ‰ But hold up, before you get too excitedâ€¦ it only estimates the memory required to load the model onto a GPU. Yep, just thatâ€”no more, no less. If youâ€™re itching to test it out, hereâ€™s the link.</p>
</section>
<section id="why-only-estimate-gpu-memory-for-loading" class="level3">
<h3 class="anchored" data-anchor-id="why-only-estimate-gpu-memory-for-loading">Why Only Estimate GPU Memory for Loading?</h3>
<p>You might be asking, â€œWhy just the memory for loading?â€ Good question! Itâ€™s because to really figure out how much resources a model needs to run (whether training or inference), you actually need to run it. Yep, no shortcuts here.</p>
<p>It all depends on things like the size of your input/batch, the quality of your data (low-res images vs.&nbsp;high-res by eg), and a whole bunch of other factors. ğŸ¤¯ Oh, and donâ€™t forget the extra memory needed to store activations during the forward pass and gradients during the backward pass. The bigger the model, the more resources youâ€™ll need. Itâ€™s a classic case of go big or go home!</p>
</section>
<section id="so-how-do-i-know-how-much-memory-my-model-needs" class="level3">
<h3 class="anchored" data-anchor-id="so-how-do-i-know-how-much-memory-my-model-needs">So, How Do I Know How Much Memory My Model Needs?</h3>
<p>Hereâ€™s the deal: The memory a model uses for training is not the same as it uses for inference. Training requires more memory because it needs to store activations and gradients for backpropagation. Unfortunately, thereâ€™s no one-size-fits-all rule to tell you exactly how much memory youâ€™ll need, but we can make an educated guess.</p>
<p>You can start by using my tool to get a minimum memory estimate for loading the model. To estimate training memory, a rough approach is to multiply that number by 10, but keep in mind this is just a ballpark figure. The exact factor can vary depending on your model architecture and batch size. To be safe, always test with different configurations to find the sweet spot.</p>
<p>During inference, models generally require less memory and run faster compared to training, but there are exceptions. Monitoring tools like <code>nvidia-smi</code> can help you keep track of actual GPU usage and avoid surprises. ğŸ“Š</p>
</section>
<section id="example-time" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="example-time">Example Time! ğŸ®</h3>
<p>Letâ€™s take a practical example. I want to fine-tune the Qwen 2 model (Qwen/Qwen2-0.5B-Instruct) on a GPU P100 with 16GB of memory on Kaggle. For this exemple, I was trying to fine-tune the model on a dataset of 10k samples with a batch size of 2 and a maximum of 800 tokens per input, on a NER task.</p>
<p>When I load the model onto the GPU, it takes up around 2.6GB of memory. Not too bad, right? But when I try to train the model, you see in the image below, it maxes out all the resources. ğŸš€</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://amenalahassa.github.io/amenalahassa/posts/assets/images/4.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">GPU Memory Usage</figcaption>
</figure>
</div>
<p>And when itâ€™s time for evaluation (where the model only does inference, no training), it crashes due to a lack of memory.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://amenalahassa.github.io/amenalahassa/posts/assets/images/2.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">GPU Memory Usage</figcaption>
</figure>
</div>
<p>ğŸ¤¦â€â™‚ï¸ Moral of the story: Even if you have the best GPU on the market, if you donâ€™t have enough memory, youâ€™re done for!</p>
<p>In fact, if I increase the batch size or the number of tokens per input, the training wonâ€™t even start. Hereâ€™s what happens when I try to train the model with a batch size of 2 and 1500 tokens per input:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://amenalahassa.github.io/amenalahassa/posts/assets/images/3.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">GPU Memory Usage</figcaption>
</figure>
</div>
<p>So be mindful of those settings when working with large models!</p>
</section>
<section id="v100-vs.-a100-vs.-whatever-gpu-what-difference-does-it-make" class="level3">
<h3 class="anchored" data-anchor-id="v100-vs.-a100-vs.-whatever-gpu-what-difference-does-it-make">V100 vs.&nbsp;A100 vs.&nbsp;Whatever GPU: What Difference Does It Make?</h3>
<p>So, you might be wondering, â€œDoes it really matter which GPU I use?â€ Well, the short answer is: Absolutely! ğŸï¸</p>
<p>Itâ€™s like traveling from Canada to France. You could either fly or bike. Pretty obvious which one gets you there faster, right? The same logic applies to GPUsâ€”more powerful ones will get the job done quicker, especially when running large models.</p>
<p>Letâ€™s break it down:</p>
<ul>
<li><p><strong>Powerful GPUs like the A100</strong> not only handle large models better but also have extra features, like mixed-precision training, that can reduce memory usage and speed things up. Theyâ€™re like the jet engines of the GPU worldâ€”fast, efficient, and capable of handling heavy workloads with ease.</p></li>
<li><p><strong>Older or less powerful GPUs like the V100</strong> can still do the job, but they might struggle with bigger models or more complex tasks. Itâ€™s like taking a slower flightâ€”still gets you there, but not as fast or smoothly.</p></li>
<li><p><strong>Whatever GPU you have</strong>, just remember: You need both memory and raw power to make your model run efficiently. If your GPU isnâ€™t powerful enough, your model might take longer to run or could even crash. And nobody wants that!</p></li>
</ul>
<p>So, whether youâ€™re eyeing the latest A100 or making do with what youâ€™ve got, the takeaway is clear: A more powerful GPU means faster, more efficient model runs. If you need to go deeper, you can read this <a href="https://timdettmers.com/2023/01/30/which-gpu-for-deep-learning/">article</a> too.</p>
</section>
<section id="alternatives-if-your-model-is-too-big" class="level3">
<h3 class="anchored" data-anchor-id="alternatives-if-your-model-is-too-big">Alternatives If Your Model Is Too Big</h3>
<p>Got a huge model with over a billion parameters? No worries, there are alternatives! You can try building a smaller model that uses fewer resources. Techniques like transfer learning, model quantization, or even using a smaller model altogether can help.</p>
<p>However, keep in mind that these approaches might impact accuracy. Sometimes the trade-off isnâ€™t that significant, and you can even set up safeguards for uncertain predictions, allowing the user to choose the most appropriate response. ğŸ’¡</p>
<p>Fun fact: Iâ€™m working on a tool to anonymize text before feeding it to a large language model (LLM), and I use one of these techniques to run the model directly in the browser. Check it out here!</p>
</section>
<section id="takeaways" class="level3">
<h3 class="anchored" data-anchor-id="takeaways">Takeaways</h3>
<p>Alright, letâ€™s wrap things up:</p>
<ol type="1">
<li>Estimating exact memory requirements for your model can be tricky, but my tool can give you a good starting point.</li>
<li>The more powerful your GPU, the faster and smoother your model will runâ€”so choose wisely!</li>
<li>If your model is too big, consider alternatives like downsizing or using techniques that reduce resource demands, though be mindful of potential accuracy trade-offs.</li>
</ol>
</section>
<section id="goodbye-and-thanks" class="level3">
<h3 class="anchored" data-anchor-id="goodbye-and-thanks">Goodbye and Thanks!</h3>
<p>Thanks for sticking with me through this post! I hope you found it helpful. If you have any thoughts, suggestions, or just want to say hi, feel free to reach out via email or drop an issue below. Iâ€™m always open to learning and would love to hear from you.</p>
<p>Take care, and happy coding! ğŸš€</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a> ]]></description>
  <category>Tips &amp; Tricks</category>
  <category>Personal Projects</category>
  <guid>https://amenalahassa.github.io/amenalahassa/posts/model_gpu.html</guid>
  <pubDate>Sat, 24 Aug 2024 00:00:00 GMT</pubDate>
  <media:content url="https://amenalahassa.github.io/amenalahassa/posts/assets/images/0_1.png" medium="image" type="image/png" height="189" width="144"/>
</item>
<item>
  <title>Finally, An Introduction: The Story Behind This Blog and Whatâ€™s Next</title>
  <link>https://amenalahassa.github.io/amenalahassa/posts/for_you.html</link>
  <description><![CDATA[ 




<section id="what-happened-indeed" class="level2">
<h2 class="anchored" data-anchor-id="what-happened-indeed">What Happened Indeed? ğŸ¤”</h2>
<p>Alright, letâ€™s be real. Life happened, right? ğŸ˜… I took some time to wrap up a few things in my life and, honestly, to kickstart a new chapter. You know that feeling when you finish one thing and feel like a whole new world opens up? Yeah, thatâ€™s where Iâ€™m at! ğŸŒŸ</p>
<p>Plus, it was the end of the school session, and I needed some well-deserved downtime. Relaxing, de-stressing, and just enjoying life for a bit. But guess what? Now Iâ€™m back, energized, and ready to take on the world! ğŸŒâœ¨</p>
<p>Iâ€™ve realized how much Iâ€™ve already accomplished, and let me tell you, Iâ€™m super grateful for all of it. ğŸ™ But I also see how much more there is to do. My blog, my job, my personal life â€“ they all need my attention, and Iâ€™m ready to dive in.</p>
<p>The possibilities ahead? Endless. Iâ€™m seizing every opportunity coming my way, and I canâ€™t wait to share the journey with you! ğŸš€</p>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">Whatâ€™s Next? ğŸ‰</h2>
<p>First off, a huge shoutout to my brothers and my family. Without them, I wouldnâ€™t be here doing what I love. You guys are the real MVPs! ğŸ’ª</p>
<p>Now, onto me. Iâ€™m committed to working on myself, becoming the best version of me. Iâ€™m just getting started on my journey, my career, my dreams â€“ and Iâ€™m 100% ready to make them a reality. Letâ€™s do this! ğŸ™Œ</p>
</section>
<section id="the-reason-behind-this-blog" class="level2">
<h2 class="anchored" data-anchor-id="the-reason-behind-this-blog">The Reason Behind This Blog ğŸ’»</h2>
<p>So, why this blog? Well, itâ€™s simple. I want to share what Iâ€™ve accomplished in my career, in AI, in software engineering â€“ and maybe some other areas too. ğŸš€</p>
<p>But hereâ€™s the thing: this isnâ€™t going to be a blog where I show you how to do things or preach about the future of AI (though, who knows, maybe a little bit of that ğŸ˜‰). Instead, itâ€™s going to be a place where I share what Iâ€™m learning, what Iâ€™m building, and who Iâ€™m building it with. And hey, Iâ€™d love to hear your thoughts, comments, and recommendations along the way. Donâ€™t hesitate! ğŸ˜Š</p>
</section>
<section id="why-now" class="level2">
<h2 class="anchored" data-anchor-id="why-now">Why Now? ğŸ¤·</h2>
<p>You know, I just realized that I never really took the time to properly introduce this blog or explain what itâ€™s all about. Better late than never, right? ğŸ˜ So, here it is! ğŸ‰</p>
</section>
<section id="how-its-built" class="level2">
<h2 class="anchored" data-anchor-id="how-its-built">How Itâ€™s Built ğŸ› ï¸</h2>
<p>For all the techies out there, Iâ€™m using Quarto, and itâ€™s deployed with GitHub Pages. I wanted to keep things simple but also have the flexibility to share code. Quartoâ€™s been perfect for that â€“ super interesting and easy to get the hang of. ğŸ‘</p>
</section>
<section id="what-else" class="level2">
<h2 class="anchored" data-anchor-id="what-else">What Else? ğŸ§</h2>
<p>Oh, and one more thing â€“ Iâ€™ve added a page to showcase all the projects Iâ€™m working on, both finished and in progress. Iâ€™ll be publishing articles explaining them, sharing why I find them interesting, and how theyâ€™re coming along. Stay tuned! ğŸš§</p>
<p>Got any comments or ideas on how I can improve? Iâ€™m all ears! ğŸ‘‚ Iâ€™ll be updating regularly on my progress and any news, so keep an eye out for more.</p>
<p>And hey, I speak French too! Je peux bien parler en franÃ§ais quâ€™en anglais, permettez-moi ce petit Ã©cart ğŸ˜‰.</p>
</section>
<section id="ok-time-to-say-goodbye" class="level2">
<h2 class="anchored" data-anchor-id="ok-time-to-say-goodbye">Ok, Time to Say Goodbye ğŸ‘‹</h2>
<p>Thatâ€™s all for now, folks! See you soon, and take care! Love you all! ğŸ’–</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a> ]]></description>
  <category>Personal Projects</category>
  <category>Updates</category>
  <guid>https://amenalahassa.github.io/amenalahassa/posts/for_you.html</guid>
  <pubDate>Fri, 23 Aug 2024 00:00:00 GMT</pubDate>
  <media:content url="https://amenalahassa.github.io/amenalahassa/posts/assets/images/0_0.png" medium="image" type="image/png" height="165" width="144"/>
</item>
<item>
  <title>How I Built a Tool to Anonymize Text for LLMs (and Why You Might Need It Too!)</title>
  <link>https://amenalahassa.github.io/amenalahassa/posts/anonymizer_intro.html</link>
  <description><![CDATA[ 




<p>Hey folks! ğŸ™Œ</p>
<p>Ever find yourself using those cool new LLMs like ChatGPT for pretty much everythingâ€”whether itâ€™s writing emails, drafting cover letters, or even creating blog content (I know I do! ğŸ˜…)? Itâ€™s like having your personal assistant right there in your browser, making life so much easier. But, waitâ€¦what happens when your prompts contain personal details? ğŸ˜¬</p>
<p>You know, that awkward moment when you realize youâ€™ve shared too much in a prompt? Yeah, been there, done that. So, I figured, why not build a tool that handles this issue and keeps things private? ğŸ’¡</p>
<section id="how-i-found-myself-working-on-this" class="level2">
<h2 class="anchored" data-anchor-id="how-i-found-myself-working-on-this">How I Found Myself Working on This ğŸ› ï¸</h2>
<p>Recently, I noticed just how much Iâ€™ve been relying on LLMs for personal stuffâ€”writing emails, tweaking my CV, crafting blogs, even coding! But every time I use them, I have to manually remove or anonymize personal info in my prompts. Talk about tedious! ğŸ˜©</p>
<p>It got to a point where I was doing this so often that I thought, â€œThereâ€™s got to be a better way!â€ And so, the idea of building a tool that runs entirely offline, right in your browser, was born. ğŸš€</p>
</section>
<section id="the-idea" class="level2">
<h2 class="anchored" data-anchor-id="the-idea">The Idea ğŸ’¡</h2>
<p>Itâ€™s super simple! Just paste your text, and voilaâ€”it anonymizes it. Now, you can safely use it in your prompts without worrying about personal details leaking out. âœ¨</p>
<section id="example-time" class="level3">
<h3 class="anchored" data-anchor-id="example-time">Example Time! âœï¸</h3>
<p>Imagine youâ€™ve have to send an email to a customer about an upcoming event at your coffee shop. Hereâ€™s what it might look like:</p>
<blockquote class="blockquote">
<p>Subject: Join us for the Grand Renovation of New York - Exciting Changes Await!</p>
<p>Dear John Green,</p>
<p>We hope this email finds you well and enjoying your favorite vanilla latte large and banana muffin at our coffee shop! As a valued and loyal customer, we are thrilled to share some exciting news with you.</p>
<p>Mark your calendar for January 4, 2023, as we invite you to join us for the grand renovation of our coffee shop at New York! We are embarking on a journey to create an even better and cozier space for you to relax, indulge, and enjoy your favorite beverages and treats.</p>
<p>You have been a cherished part of our coffee shop family for an incredible 5 years, and we cannot wait to show our appreciation by unveiling a fresh, modern look that will elevate your coffee shop experience. The renovation will bring about stylish and comfortable seating areas, captivating artwork, and state-of-the-art equipment to enhance the quality of our offerings.</p>
<p>The grand reopening event promises to be a celebration filled with delightful surprises. As our special guest, you will be among the first to explore the redesigned space and sample our latest menu additions. Immerse yourself in the inviting ambiance, meet our talented baristas, and indulge in the aroma of freshly brewed coffee that is synonymous with our coffee shop. We value your opinion, John Green, and would be thrilled to hear your thoughts and feedback on our newly renovated space. As always, our commitment remains to provide you with exceptional customer service and the highest quality products that you know and love.</p>
<p>Save the date: January 4, 2023! We cannot wait to welcome you to the grand renovation of our coffee shop at New York. Together, letâ€™s embark on this exciting journey and create countless new memories over aromatic coffees and delectable treats.</p>
<p>Thank you for being an integral part of our coffee shopâ€™s success. We look forward to continuing to serve you and make your coffee experiences unforgettable.</p>
<p>Warmest regards,</p>
</blockquote>
<p>You paste it into the tool, and <em>poof</em>â€”it replaces those details with anonymous IDs. ğŸ•µï¸â€â™€ï¸</p>
<blockquote class="blockquote">
<p>Subject: Join us for the Grand Renovation of aLOCATION_524a - Exciting Changes Await!</p>
<p>Dear aPEOPLE_872a,</p>
<p>We hope this email finds you well and enjoying your favorite vanilla latte large and banana muffin at our coffee shop! As a valued and loyal customer, we are thrilled to share some exciting news with you.</p>
<p>Mark your calendar for aDATE_988a, as we invite you to join us for the grand renovation of our coffee shop at aLOCATION_524a! We are embarking on a journey to create an even better and cozier space for you to relax, indulge, and enjoy your favorite beverages and treats.</p>
<p>You have been a cherished part of our coffee shop family for an incredible 5 years, and we cannot wait to show our appreciation by unveiling a fresh, modern look that will elevate your coffee shop experience. The renovation will bring about stylish and comfortable seating areas, captivating artwork, and state-of-the-art equipment to enhance the quality of our offerings.</p>
<p>The grand reopening event promises to be a celebration filled with delightful surprises. As our special guest, you will be among the first to explore the redesigned space and sample our latest menu additions. Immerse yourself in the inviting ambiance, meet our talented baristas, and indulge in the aroma of freshly brewed coffee that is synonymous with our coffee shop. We value your opinion, aPEOPLE_872a, and would be thrilled to hear your thoughts and feedback on our newly renovated space. As always, our commitment remains to provide you with exceptional customer service and the highest quality products that you know and love.</p>
<p>Save the date: aDATE_988a! We cannot wait to welcome you to the grand renovation of our coffee shop at aLOCATION_524a. Together, letâ€™s embark on this exciting journey and create countless new memories over aromatic coffees and delectable treats.</p>
<p>Thank you for being an integral part of our coffee shopâ€™s success. We look forward to continuing to serve you and make your coffee experiences unforgettable.</p>
<p>Warmest regards,</p>
</blockquote>
<p>Then, you can use that anonymized text in your LLM prompt. Once you get the LLMâ€™s response, you paste it back into the tool, and it replaces the IDs with your original info. As simple as that! ğŸ˜</p>
</section>
</section>
<section id="how-to-try-it" class="level2">
<h2 class="anchored" data-anchor-id="how-to-try-it">How to Try It? ğŸ¤”</h2>
<p>Excited to give it a spin? You can check it out <a href="https://amenalahassa.github.io/web-anonymiser/">here</a>. Itâ€™s still a work in progress (so donâ€™t judge me too harshly! ğŸ˜œ), but the full offline version is coming soon.</p>
<p>For now, you can test it out and share your thoughts with me. Your feedback means the world! ğŸŒ</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps ğŸš€</h2>
<p>Hereâ€™s what Iâ€™ve got cooking for the future:</p>
<ul>
<li>Turning it into a browser extension that automatically catches text you paste into input boxes, helping protect your identity on the fly.</li>
<li>Extending the tool to handle PII (Personally Identifiable Information) with customizable options for what to anonymize.</li>
<li>And so much more! ğŸ‰</li>
</ul>
</section>
<section id="but-why" class="level2">
<h2 class="anchored" data-anchor-id="but-why">But Why? ğŸ¤·â€â™‚ï¸</h2>
<p>Good question! There are already some awesome tools out there, like <a href="https://www.pontus.so/blog">this one</a> and <a href="https://github.com/AI-LLM/AnonymizedGPT?tab=readme-ov-file">this GitHub repo</a>. But none of them are quite what I was looking forâ€”so I decided to share mine! ğŸ˜„</p>
<p>If youâ€™ve got any comments, feel free to reach out or open an issue. Iâ€™m all ears! ğŸ‘‚</p>
</section>
<section id="it-was-fun-and-educational" class="level2">
<h2 class="anchored" data-anchor-id="it-was-fun-and-educational">It Was Fun and Educational! ğŸ“</h2>
<p>Building this tool was such a learning experience. I dove into ONNX, WebGPU, WebAssembly, Transformer.js, Hugging Face Inference, Angular 18, and so much more. And, boy, did I learn a lot! ğŸ’»</p>
<section id="also-a-few-things-i-noticed" class="level3">
<h3 class="anchored" data-anchor-id="also-a-few-things-i-noticed">Also, a Few Things I Noticedâ€¦ ğŸ§</h3>
<ul>
<li>Running an LLM in the browser without a GPU can be <strong>super slow</strong>. ğŸ¢</li>
<li>Not all browsers support WebGPU, so thatâ€™s a challenge.</li>
<li>To run a model in the browser, you need a <strong>really light model</strong>, preferably quantized and optimized for the web (like with Olive, for example). Ideally, it should run on WebGPU for the best performance.</li>
</ul>
</section>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughtsâ€¦ ğŸ‰</h2>
<p>Overall, itâ€™s been a fantastic experience. Version 2 is already in the works, so stay tuned! ğŸ˜</p>
<p>Thanks so much for reading, and donâ€™t hesitate to reach out with your thoughts.</p>
<p>Cheers! ğŸ¥‚</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a> ]]></description>
  <category>Tips &amp; Tricks</category>
  <category>Personal Projects</category>
  <guid>https://amenalahassa.github.io/amenalahassa/posts/anonymizer_intro.html</guid>
  <pubDate>Fri, 23 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Passer de Yolo Ã  CocoDetection, câ€™est possible !</title>
  <link>https://amenalahassa.github.io/amenalahassa/posts/dataset-converter.html</link>
  <description><![CDATA[ 




<section id="de-quoi-sagit-il" class="level1">
<h1>De quoi sâ€™agit-il ?</h1>
<p>Dans ce post, je montre comment convertir un dataset YOLO en format COCO en utilisant la bibliothÃ¨que Python <code>globox</code>, une solution pratique que jâ€™ai rÃ©cemment appliquÃ©e pour un projet de segmentation dâ€™instance. <code>globox</code> permet Ã©galement de faire lâ€™inverse, ainsi que de nombreuses autres conversions de formats de datasets. Je vous invite Ã  explorer ce package pour dÃ©couvrir toutes les possibilitÃ©s quâ€™il offre.</p>
</section>
<section id="ok-Ã§a-donne-quoi" class="level1">
<h1>Ok, Ã§a donne quoi ?</h1>
<div id="cell-4" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>pip install globox</span>
<span id="cb1-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>pip install pycocotools</span></code></pre></div>
</details>
</div>
<div id="cell-5" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torchvision.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CocoDetection</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> globox <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AnnotationSet</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb2-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.patches <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> patches</span>
<span id="cb2-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span></code></pre></div>
</details>
</div>
<p>Le code ci-dessous initialise trois chemins en utilisant la bibliothÃ¨que <code>Path</code> de Python. Les chemins <code>label_path</code> et <code>image_path</code> pointent respectivement vers les dossiers contenant les Ã©tiquettes et les images du dataset YOLO. Ensuite, le chemin <code>save_file</code> est dÃ©fini pour sauvegarder le fichier de sortie au format COCO. Enfin, la commande <code>annotations = AnnotationSet.from_yolo_v7(label_path, image_folder=image_path)</code> crÃ©e un ensemble dâ€™annotations Ã  partir des Ã©tiquettes YOLO et des images associÃ©es, prÃªt Ã  Ãªtre converti au format COCO.</p>
<div id="cell-7" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-31T01:59:02.484254Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-31T01:59:02.484793Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-31T01:59:36.773381Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-31T01:59:02.484759Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-31T01:59:36.772245Z&quot;}" data-trusted="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">label_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/kaggle/input/medleaves-medicinal-plant-leaves-dataset/MedLeaves/MedLeaves/train/labels"</span>)</span>
<span id="cb3-2">image_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/kaggle/input/medleaves-medicinal-plant-leaves-dataset/MedLeaves/MedLeaves/train/images"</span>) </span>
<span id="cb3-3"></span>
<span id="cb3-4">save_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/kaggle/working/medleaves-coco.json"</span>)</span>
<span id="cb3-5"></span>
<span id="cb3-6">annotations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AnnotationSet.from_yolo_v7(label_path, image_folder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>image_path)</span></code></pre></div>
</div>
<p>La commande <code>annotations.show_stats()</code> est utilisÃ©e pour afficher des statistiques sur lâ€™ensemble dâ€™annotations crÃ©Ã© prÃ©cÃ©demment. Cette mÃ©thode fournit un rÃ©sumÃ© utile des donnÃ©es annotÃ©es, comme le nombre total dâ€™images, dâ€™annotations, et la distribution des catÃ©gories dâ€™objets. Cela permet de vÃ©rifier rapidement lâ€™Ã©tat et la qualitÃ© des annotations avant de procÃ©der Ã  des opÃ©rations de conversion ou dâ€™entraÃ®nement de modÃ¨les.</p>
<div id="cell-9" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-31T01:59:41.476666Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-31T01:59:41.477084Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-31T01:59:41.546606Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-31T01:59:41.477049Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-31T01:59:41.545284Z&quot;}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">annotations.show_stats()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">      Database Stats      </span>
â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ<span style="font-weight: bold"> Label </span>â”ƒ<span style="font-weight: bold"> Images </span>â”ƒ<span style="font-weight: bold"> Boxes </span>â”ƒ
â”¡â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0     â”‚    415 â”‚  2322 â”‚
â”‚ 1     â”‚    408 â”‚   498 â”‚
â”‚ 10    â”‚    416 â”‚   588 â”‚
â”‚ 11    â”‚    412 â”‚   612 â”‚
â”‚ 12    â”‚    414 â”‚  2401 â”‚
â”‚ 13    â”‚    410 â”‚   810 â”‚
â”‚ 14    â”‚    412 â”‚  2750 â”‚
â”‚ 15    â”‚    408 â”‚  1605 â”‚
â”‚ 16    â”‚    411 â”‚  2237 â”‚
â”‚ 17    â”‚    411 â”‚  2662 â”‚
â”‚ 18    â”‚    409 â”‚   682 â”‚
â”‚ 19    â”‚    413 â”‚  5032 â”‚
â”‚ 2     â”‚    414 â”‚  5830 â”‚
â”‚ 20    â”‚    405 â”‚   882 â”‚
â”‚ 21    â”‚    415 â”‚  2892 â”‚
â”‚ 22    â”‚    409 â”‚   540 â”‚
â”‚ 23    â”‚    414 â”‚  1275 â”‚
â”‚ 24    â”‚    411 â”‚   727 â”‚
â”‚ 25    â”‚    407 â”‚  4778 â”‚
â”‚ 26    â”‚    413 â”‚  1255 â”‚
â”‚ 27    â”‚    406 â”‚   997 â”‚
â”‚ 28    â”‚    411 â”‚   618 â”‚
â”‚ 29    â”‚    409 â”‚  1143 â”‚
â”‚ 3     â”‚    411 â”‚  1584 â”‚
â”‚ 4     â”‚    405 â”‚  3082 â”‚
â”‚ 5     â”‚    405 â”‚  1275 â”‚
â”‚ 6     â”‚    416 â”‚   769 â”‚
â”‚ 7     â”‚    403 â”‚   570 â”‚
â”‚ 8     â”‚    409 â”‚  1563 â”‚
â”‚ 9     â”‚    410 â”‚  2475 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span style="font-weight: bold"> Total </span>â”‚<span style="font-weight: bold">  12312 </span>â”‚<span style="font-weight: bold"> 54454 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>
</div>
<p>Câ€™est ici que la magie Ã  lieu ! La commande <code>annotations.save_coco(save_file, auto_ids=True)</code> sauvegarde lâ€™ensemble dâ€™annotations dans un fichier au format COCO, en utilisant le chemin spÃ©cifiÃ© par <code>save_file</code>. Lâ€™option <code>auto_ids=True</code> indique que les identifiants pour les annotations et les images seront gÃ©nÃ©rÃ©s automatiquement si nÃ©cessaire.</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">annotations.save_coco(save_file, auto_ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</div>
<p>Visualisons ensuite le rÃ©sultat, mais en chargeant les donnÃ©es au format CocoDetection. Le code ci-dessous fait cela en utilisant la classe <code>CocoDetection</code> de la bibliothÃ¨que PyTorch.</p>
<p>Le paramÃ¨tre <code>root</code> est dÃ©fini avec le chemin vers le dossier des images (<code>image_path</code>), tandis que <code>annFile</code> spÃ©cifie le chemin du fichier dâ€™annotations au format COCO (<code>save_file</code>).</p>
<p>Enfin, <code>train_data[0][0]</code> accÃ¨de Ã  la premiÃ¨re image du dataset, afin ainsi de le visualiser.</p>
<div id="cell-13" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-31T02:00:43.044327Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-31T02:00:43.044769Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-31T02:00:43.221923Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-31T02:00:43.044735Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-31T02:00:43.220768Z&quot;}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">train_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CocoDetection(root <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image_path, annFile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> save_file, transform <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb6-2">train_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><img src="https://amenalahassa.github.io/amenalahassa/posts/dataset-converter_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Profitons pour visualiser une image du dataset avec ses annotations (bbox) superposÃ©es sur lâ€™image.</p>
<div id="cell-15" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-31T02:04:51.070855Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-31T02:04:51.071241Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-31T02:04:51.522270Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-31T02:04:51.071213Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-31T02:04:51.520708Z&quot;}" data-trusted="true" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Obtenir la premiÃ¨re image et ses annotations</span></span>
<span id="cb7-2">image, annotations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convertir l'image PIL en tableau numpy pour l'affichage</span></span>
<span id="cb7-5">image_np <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(image)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CrÃ©er un graphique</span></span>
<span id="cb7-8">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-9">ax.imshow(image_np)</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tracer chaque boÃ®te englobante</span></span>
<span id="cb7-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ann <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> annotations:</span>
<span id="cb7-13">    bbox <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ann[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bbox'</span>]</span>
<span id="cb7-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Le format de boÃ®te englobante COCO est [x, y, largeur, hauteur]</span></span>
<span id="cb7-15">    rect <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> patches.Rectangle((bbox[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], bbox[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), bbox[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], bbox[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, facecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span>
<span id="cb7-16">    ax.add_patch(rect)</span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher le graphique</span></span>
<span id="cb7-19">plt.show()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://amenalahassa.github.io/amenalahassa/posts/dataset-converter_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Jâ€™espÃ¨re que cela vous sera utile. Nâ€™hÃ©sitez pas Ã  me contacter si vous avez des questions ou des recommendations. Ã€ la prochaine ! :-)</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a> ]]></description>
  <category>Tips &amp; Tricks</category>
  <category>Tutorial</category>
  <guid>https://amenalahassa.github.io/amenalahassa/posts/dataset-converter.html</guid>
  <pubDate>Thu, 30 May 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Predicting reply under comment with LLM</title>
  <link>https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm.html</link>
  <description><![CDATA[ 




<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>This project originally started as a school assignment for Big Data class. The notebook presented here demonstrates the use of a large language model (LLM) to tackle a binary classification problem. Specifically, our objective is to predict whether a comment will receive a response or not.</p>
<p>To achieve this, we use an enriched dataset compiled from comments on Le Soleilâ€™s Facebook posts. I will also share a separate notebook detailing the process of building this dataset. Additionally, I plan to publish another post explaining how to utilize simple feedforward neural networks or statistical models based on various comment features or the comment text itself.</p>
<p>Letâ€™s dive in!</p>
</section>
<section id="dependence" class="level2">
<h2 class="anchored" data-anchor-id="dependence">Dependence</h2>
<p>I prefer to set aside the cell that install system dependency. It always produces a lot of useless gx3di3ceâ€¦ You get it, right ?</p>
<div id="cell-4" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-16T22:47:58.621291Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-16T22:47:58.621693Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-16T22:48:24.158787Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-16T22:47:58.621662Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-16T22:48:24.157602Z&quot;}" data-trusted="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>pip install torchsampler</span>
<span id="cb1-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>pip install sacremoses</span></code></pre></div>
</details>
</div>
<p>Now, letâ€™s import some packages to have fun !</p>
<div id="cell-6" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-16T22:48:24.161082Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-16T22:48:24.161438Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-16T22:48:24.487077Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-16T22:48:24.161404Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-16T22:48:24.486273Z&quot;}" data-trusted="true" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> transformers, torch</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> multiprocessing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mp</span>
<span id="cb2-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AutoModelForSequenceClassification, AutoTokenizer</span>
<span id="cb2-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dataset</span>
<span id="cb2-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> accuracy_score, precision_score, recall_score, confusion_matrix</span>
<span id="cb2-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torchsampler <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ImbalancedDatasetSampler</span>
<span id="cb2-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> train_test_split</span>
<span id="cb2-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tqdm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm</span>
<span id="cb2-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.optim.lr_scheduler <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ReduceLROnPlateau</span>
<span id="cb2-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> IPython.display <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> clear_output</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># warnings.filterwarnings('ignore')</span></span>
<span id="cb2-17">device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cuda'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.cuda.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cpu'</span></span>
<span id="cb2-18">mp.cpu_count() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># used to set the number of num_worker for Dataloader, usually the half of it </span></span></code></pre></div>
</details>
</div>
<p>And since I use Google colab, I mount my drive to load the datasets later.</p>
<div id="cell-8" class="cell" data-outputid="aac39525-ff34-4217-825e-b73595c599ff" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only if you are using Google colab of course...</span></span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> google.colab <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> drive</span>
<span id="cb3-3">drive.mount(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/content/drive'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mounted at /content/drive</code></pre>
</div>
</div>
</section>
<section id="about-our-datasets" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="about-our-datasets">About our datasets</h2>
<p>In this section, we will explore the dataset used for our binary classification problem. The dataset has been divided into training and testing sets, with 70% of the data allocated for training and the remaining 30% for testing. This split ensures that we have a robust training set to build our model while retaining a sufficient portion of the data for evaluating the modelâ€™s performance.</p>
<p>Letâ€™s load the train and the test sets.</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">dirpath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/content/drive/MyDrive/DataSets/big_data/datasets'</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify here the path to the dataset</span></span>
<span id="cb5-2">train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(dirpath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/split/train_dataset.csv'</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-3">test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(dirpath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/split/valid_dataset.csv'</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<p>A few statistics about our dataset. First of all, it contains almost a million rows.</p>
<div id="cell-13" class="cell" data-outputid="5e429f03-52cb-4fd3-8666-97f14baf1375" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([train, test])</span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Dataset shape: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>dataset<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>shape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset shape: (935698, 68)</code></pre>
</div>
</div>
<p>Secondly, the dataset is highly unbalanced. The following graph shows that there are only ~13% of comments with replies, by which I mean that these comments have received at least one comment.</p>
<div id="cell-15" class="cell" data-outputid="18b63c43-03e4-4e3b-f0e5-7ed81288739d" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>].value_counts(normalize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>target
False    0.876036
True     0.123964
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<div id="cell-fig-cap-margin0" class="cell page-columns page-full" data-outputid="85557c40-d918-45eb-f3f8-813cf72c9a94" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>].value_counts().plot(kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bar'</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-cap-margin0" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-cap-margin0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm_files/figure-html/fig-cap-margin0-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-cap-margin0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Barchart of the count of each class
</figcaption>
</figure>
</div>
</div>
</div>
<p>We have then two significant issues. Firstly, running the training on the entire dataset would be extremely time-consuming, even with substantial computational resources. Secondly, our dataset is unbalanced, which presents a challenge for accurate model training.</p>
<p>To address these issues, I opted for undersampling, ensuring an equal number of items from each class. This approach allows us to run our experiments more efficiently and mitigates the problem of data imbalance. Later in the notebook, we will explore the impact of the amount of data used on the modelâ€™s performance.</p>
</section>
<section id="class-and-functions" class="level2">
<h2 class="anchored" data-anchor-id="class-and-functions">Class and functions</h2>
<p>I write the CommentDataset class as a custom dataset designed for handling text data. It inherits from the Dataset class provided by PyTorch. This class is specifically tailored for tokenizing and preparing text data along with their corresponding labels for use in a model.</p>
<div id="cell-20" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-16T22:48:47.461504Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-16T22:48:47.461808Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-16T22:48:47.470522Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-16T22:48:47.461784Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-16T22:48:47.469657Z&quot;}" data-trusted="true" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> CommentDataset(Dataset):</span>
<span id="cb11-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, message, labels, tokenizer):</span>
<span id="cb11-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> message</span>
<span id="cb11-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> labels</span>
<span id="cb11-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.tokenizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tokenizer</span>
<span id="cb11-6"></span>
<span id="cb11-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_labels(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.labels</span>
<span id="cb11-9"></span>
<span id="cb11-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__len__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message)</span>
<span id="cb11-12"></span>
<span id="cb11-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__getitem__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, idx):</span>
<span id="cb11-14">        text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message[idx]</span>
<span id="cb11-15">        label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.labels[idx]</span>
<span id="cb11-16"></span>
<span id="cb11-17">        inputs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.tokenizer.encode_plus(text, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, add_special_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, padding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'max_length'</span>, return_token_type_ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, truncation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb11-18"></span>
<span id="cb11-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb11-20">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_ids'</span>: torch.tensor(inputs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_ids'</span>], dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>),</span>
<span id="cb11-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'attention_mask'</span>: torch.tensor(inputs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'attention_mask'</span>], dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>),</span>
<span id="cb11-22">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'token_type_ids'</span>: torch.tensor(inputs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"token_type_ids"</span>], dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>),</span>
<span id="cb11-23">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'labels'</span>: torch.tensor(label, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb11-24">        }</span></code></pre></div>
</details>
</div>
<p>The <code>train_model</code> method is designed to train a machine learning model using a provided training and testing dataloader, while tracking various performance metrics such as loss, accuracy, precision, recall, and a custom F2 score across multiple epochs, and implementing early stopping based on validation performance. The <code>test_model</code> method evaluates the trained model on a validation dataset, computing and printing evaluation metrics to assess the modelâ€™s performance.</p>
<div id="cell-22" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-16T22:48:47.471853Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-16T22:48:47.472149Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-16T22:48:47.496708Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-16T22:48:47.472105Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-16T22:48:47.495859Z&quot;}" data-trusted="true" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> train_model(model, train_dataloader, test_dataloader, history<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{}, num_epochs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5e-5</span>, early_stopping_patience<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, weight_decay<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>):</span>
<span id="cb12-2">    device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.device(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.cuda.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span>)</span>
<span id="cb12-3">    model.to(device)</span>
<span id="cb12-4">    optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.optim.AdamW(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lr, weight_decay<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>weight_decay)</span>
<span id="cb12-5">    scheduler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ReduceLROnPlateau(optimizer, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'max'</span>, factor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, patience<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ReduceLROnPlateau scheduler</span></span>
<span id="cb12-6">    loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.BCEWithLogitsLoss()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Binary Cross-Entropy Loss</span></span>
<span id="cb12-7"></span>
<span id="cb12-8">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_loss'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-9">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_accuracy'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-10">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_precision'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-11">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_recall'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-12">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_accuracy'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-13">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_precision'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-14">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_recall'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-15">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'epochs'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-16">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_loss'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-17">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'valid_score'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-18">    best_valid_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb12-19">    early_stopping_counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb12-20"></span>
<span id="cb12-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_epochs):</span>
<span id="cb12-22">        model.train()</span>
<span id="cb12-23">        train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb12-24">        train_preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-25">        train_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-26"></span>
<span id="cb12-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Training loop</span></span>
<span id="cb12-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _, batch <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(tqdm(train_dataloader, desc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Epoch </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>num_epochs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)):</span>
<span id="cb12-29">            optimizer.zero_grad()</span>
<span id="cb12-30"></span>
<span id="cb12-31">            input_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_ids'</span>].to(device)</span>
<span id="cb12-32">            attention_mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'attention_mask'</span>].to(device)</span>
<span id="cb12-33">            token_type_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'token_type_ids'</span>].to(device)</span>
<span id="cb12-34">            labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'labels'</span>].to(device)</span>
<span id="cb12-35"></span>
<span id="cb12-36">            outputs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(input_ids, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>attention_mask, token_type_ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>token_type_ids)</span>
<span id="cb12-37">            logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> outputs.logits.squeeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-38">            loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loss_fn(logits, labels)</span>
<span id="cb12-39">            loss.backward()</span>
<span id="cb12-40">            optimizer.step()</span>
<span id="cb12-41"></span>
<span id="cb12-42">            train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss.item()</span>
<span id="cb12-43">            train_preds.extend((logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>().tolist())</span>
<span id="cb12-44">            train_labels.extend(labels.tolist())</span>
<span id="cb12-45"></span>
<span id="cb12-46">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate metrics on training set</span></span>
<span id="cb12-47">        train_accuracy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(train_labels, train_preds)</span>
<span id="cb12-48">        train_precision <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> precision_score(train_labels, train_preds, average<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'binary'</span>)</span>
<span id="cb12-49">        train_recall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> recall_score(train_labels, train_preds, average<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'binary'</span>)</span>
<span id="cb12-50"></span>
<span id="cb12-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evaluation loop</span></span>
<span id="cb12-52">        model.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span>()</span>
<span id="cb12-53">        test_preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-54">        test_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-55">        test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb12-56"></span>
<span id="cb12-57">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb12-58">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> batch <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> test_dataloader:</span>
<span id="cb12-59"></span>
<span id="cb12-60">                input_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_ids'</span>].to(device)</span>
<span id="cb12-61">                attention_mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'attention_mask'</span>].to(device)</span>
<span id="cb12-62">                token_type_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'token_type_ids'</span>].to(device)</span>
<span id="cb12-63">                labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'labels'</span>].to(device)</span>
<span id="cb12-64">                outputs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(input_ids, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>attention_mask, token_type_ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>token_type_ids)</span>
<span id="cb12-65">                logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> outputs.logits.squeeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-66">                loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loss_fn(logits, labels)</span>
<span id="cb12-67"></span>
<span id="cb12-68">                test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss.item()</span>
<span id="cb12-69">                test_preds.extend((logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>().tolist())</span>
<span id="cb12-70">                test_labels.extend(labels.tolist())</span>
<span id="cb12-71"></span>
<span id="cb12-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate metrics on test set</span></span>
<span id="cb12-73">        test_accuracy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(test_labels, test_preds)</span>
<span id="cb12-74">        test_precision <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> precision_score(test_labels, test_preds, average<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'binary'</span>)</span>
<span id="cb12-75">        test_recall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> recall_score(test_labels, test_preds, average<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'binary'</span>)</span>
<span id="cb12-76">        tn, fp, fn, tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> confusion_matrix(test_labels, test_preds).ravel()</span>
<span id="cb12-77">        valid_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fn)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-78"></span>
<span id="cb12-79">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update learning rate scheduler</span></span>
<span id="cb12-80">        scheduler.step(valid_score)</span>
<span id="cb12-81"></span>
<span id="cb12-82">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'epochs'</span>].append(epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-83"></span>
<span id="cb12-84">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_loss'</span>].append(train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_dataloader))</span>
<span id="cb12-85">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_accuracy'</span>].append(train_accuracy)</span>
<span id="cb12-86">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_precision'</span>].append(train_precision)</span>
<span id="cb12-87">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_recall'</span>].append(train_recall)</span>
<span id="cb12-88"></span>
<span id="cb12-89">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_loss'</span>].append(test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(test_dataloader))</span>
<span id="cb12-90">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_accuracy'</span>].append(test_accuracy)</span>
<span id="cb12-91">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_precision'</span>].append(test_precision)</span>
<span id="cb12-92">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_recall'</span>].append(test_recall)</span>
<span id="cb12-93">        history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'valid_score'</span>].append(valid_score)</span>
<span id="cb12-94"></span>
<span id="cb12-95">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Epoch </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>num_epochs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:"</span>)</span>
<span id="cb12-96"></span>
<span id="cb12-97">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Train Loss: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_dataloader)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-98">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Test Loss: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(test_dataloader)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-99">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Train Accuracy: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>train_accuracy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-100">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Train Precision: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>train_precision<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-101">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Train Recall: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>train_recall<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-102"></span>
<span id="cb12-103">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Test Accuracy: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_accuracy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-104">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Test Precision: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_precision<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-105">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Test Recall: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_recall<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-106">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Test F2: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>valid_score<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-107"></span>
<span id="cb12-108">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Early stopping</span></span>
<span id="cb12-109">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> valid_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> best_valid_score:</span>
<span id="cb12-110">            best_valid_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> valid_score</span>
<span id="cb12-111">            early_stopping_counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb12-112">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb12-113">            early_stopping_counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-114"></span>
<span id="cb12-115">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> early_stopping_counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> early_stopping_patience:</span>
<span id="cb12-116">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Early stopping triggered!"</span>)</span>
<span id="cb12-117">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb12-118"></span>
<span id="cb12-119"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> test_model(tokz, model, valid_data, history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb12-120">    model.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span>()</span>
<span id="cb12-121">    test_preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-122">    test_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-123">    test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb12-124"></span>
<span id="cb12-125">    valid_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CommentDataset(valid_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].to_numpy(), valid_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>).to_numpy(), tokz)</span>
<span id="cb12-126">    test_dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.DataLoader(valid_dataset, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bs, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-127">    loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.BCEWithLogitsLoss()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Binary Cross-Entropy Loss</span></span>
<span id="cb12-128"></span>
<span id="cb12-129">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb12-130">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> batch <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> test_dataloader:</span>
<span id="cb12-131">            input_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_ids'</span>].to(device)</span>
<span id="cb12-132">            attention_mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'attention_mask'</span>].to(device)</span>
<span id="cb12-133">            token_type_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'token_type_ids'</span>].to(device)</span>
<span id="cb12-134">            labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> batch[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'labels'</span>].to(device)</span>
<span id="cb12-135">            outputs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(input_ids, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>attention_mask, token_type_ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>token_type_ids)</span>
<span id="cb12-136">            logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> outputs.logits.squeeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-137">            loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loss_fn(logits, labels)</span>
<span id="cb12-138"></span>
<span id="cb12-139">            test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss.item()</span>
<span id="cb12-140">            test_preds.extend((logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>().tolist())</span>
<span id="cb12-141">            test_labels.extend(labels.tolist())</span>
<span id="cb12-142"></span>
<span id="cb12-143">    test_accuracy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(test_labels, test_preds)</span>
<span id="cb12-144">    test_precision <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> precision_score(test_labels, test_preds)</span>
<span id="cb12-145">    test_recall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> recall_score(test_labels, test_preds)</span>
<span id="cb12-146">    tn, fp, fn, tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> confusion_matrix(test_labels, test_preds).ravel()</span>
<span id="cb12-147">    history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'valid_score'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (tp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fn)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-148"></span>
<span id="cb12-149">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test Metrics:"</span>)</span>
<span id="cb12-150">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Eval Accuracy: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_accuracy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-151">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Eval Precision: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_precision<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-152">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Eval Recall: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>test_recall<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-153">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  Eval F2: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'valid_score'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<p>The <code>plot_history</code> method visualizes the training and testing metrics (loss, accuracy, precision, recall, and F2 score) over epochs using matplotlib. The <code>evaluate_model</code> function assesses the model by optionally plotting the training history and running the <code>test_model</code> function for evaluation metrics. The <code>get_loader</code> function prepares the data loaders for training and testing datasets, including optional under-sampling, and sets up the tokenizer and model for sequence classification tasks. The <code>equal_class_sampling</code> method ensures balanced class distribution by sampling an equal number of instances from each class in the dataset.</p>
<div id="cell-24" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-17T00:15:24.440839Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-17T00:15:24.441301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-17T00:15:24.453534Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-17T00:15:24.441258Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-17T00:15:24.452391Z&quot;}" data-trusted="true" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_history(history):</span>
<span id="cb13-2">    plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb13-3"></span>
<span id="cb13-4">    epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'epochs'</span>]</span>
<span id="cb13-5">    train_losses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_loss'</span>]</span>
<span id="cb13-6">    test_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_loss'</span>]</span>
<span id="cb13-7">    train_accuracies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_accuracy'</span>]</span>
<span id="cb13-8">    test_accuracies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_accuracy'</span>]</span>
<span id="cb13-9">    train_precisions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_precision'</span>]</span>
<span id="cb13-10">    test_precisions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_precision'</span>]</span>
<span id="cb13-11">    train_recall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'train_recall'</span>]</span>
<span id="cb13-12">    test_recall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test_recall'</span>]</span>
<span id="cb13-13">    valid_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'valid_score'</span>]</span>
<span id="cb13-14"></span>
<span id="cb13-15">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-16">    plt.plot(epochs, train_losses, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training Loss'</span>)</span>
<span id="cb13-17">    plt.plot(epochs, test_loss, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test Loss'</span>)</span>
<span id="cb13-18">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epochs'</span>)</span>
<span id="cb13-19">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Loss'</span>)</span>
<span id="cb13-20">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training Loss'</span>)</span>
<span id="cb13-21"></span>
<span id="cb13-22">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb13-23">    plt.plot(epochs, train_accuracies, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training Accuracy'</span>)</span>
<span id="cb13-24">    plt.plot(epochs, test_accuracies, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test Accuracy'</span>)</span>
<span id="cb13-25">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epochs'</span>)</span>
<span id="cb13-26">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy'</span>)</span>
<span id="cb13-27">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy'</span>)</span>
<span id="cb13-28">    plt.legend()</span>
<span id="cb13-29"></span>
<span id="cb13-30">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb13-31">    plt.plot(epochs, train_precisions, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training Precision'</span>)</span>
<span id="cb13-32">    plt.plot(epochs, test_precisions, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test Precision'</span>)</span>
<span id="cb13-33">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epochs'</span>)</span>
<span id="cb13-34">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Precision'</span>)</span>
<span id="cb13-35">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Precision'</span>)</span>
<span id="cb13-36">    plt.legend()</span>
<span id="cb13-37"></span>
<span id="cb13-38">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb13-39">    plt.plot(epochs, train_recall, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training Recall'</span>)</span>
<span id="cb13-40">    plt.plot(epochs, test_recall, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test Recall'</span>)</span>
<span id="cb13-41">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epochs'</span>)</span>
<span id="cb13-42">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Recall'</span>)</span>
<span id="cb13-43">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Recall'</span>)</span>
<span id="cb13-44">    plt.legend()</span>
<span id="cb13-45"></span>
<span id="cb13-46">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb13-47">    plt.plot(epochs, valid_score, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training F2'</span>)</span>
<span id="cb13-48">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epochs'</span>)</span>
<span id="cb13-49">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'F2'</span>)</span>
<span id="cb13-50">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'F2'</span>)</span>
<span id="cb13-51">    plt.legend()</span>
<span id="cb13-52"></span>
<span id="cb13-53">    plt.tight_layout()</span>
<span id="cb13-54">    plt.show()</span>
<span id="cb13-55">    </span>
<span id="cb13-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> evaluate_model(tokz, model, valid_data, history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, plot_train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>):</span>
<span id="cb13-57">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> plot_train:</span>
<span id="cb13-58">        plot_history(history)</span>
<span id="cb13-59">    test_model(tokz, model, valid_data, history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bs)</span>
<span id="cb13-60">    </span>
<span id="cb13-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_loader(model_nm, dataset, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, under_sample<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_class <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, use_pad_token<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, use_special_pad_token<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>):</span>
<span id="cb13-62">    X_train, y_train, X_test, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_train'</span>], dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_train'</span>], dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_test'</span>], dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_test'</span>]</span>
<span id="cb13-63">    tokz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoTokenizer.from_pretrained(model_nm)</span>
<span id="cb13-64"></span>
<span id="cb13-65">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoModelForSequenceClassification.from_pretrained(model_nm, num_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_class)</span>
<span id="cb13-66"></span>
<span id="cb13-67">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(X_train) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb13-68">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> model, tokz, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-69"></span>
<span id="cb13-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_pad_token:</span>
<span id="cb13-71">        tokz.pad_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tokz.eos_token</span>
<span id="cb13-72">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_special_pad_token:</span>
<span id="cb13-73">        tokz.add_special_tokens({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pad_token'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'[PAD]'</span>})</span>
<span id="cb13-74"></span>
<span id="cb13-75">    model.resize_token_embeddings(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tokz))</span>
<span id="cb13-76"></span>
<span id="cb13-77">    train_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CommentDataset(X_train.to_numpy(), y_train.astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>).to_numpy(), tokz)</span>
<span id="cb13-78">    test_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CommentDataset(X_test.to_numpy(), y_test.astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>).to_numpy(), tokz)</span>
<span id="cb13-79"></span>
<span id="cb13-80">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> under_sample:</span>
<span id="cb13-81">        train_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.DataLoader(train_dataset, sampler<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ImbalancedDatasetSampler(train_dataset), batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bs, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_workers, pin_memory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-82">        test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.DataLoader(test_dataset, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bs, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_workers, pin_memory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-83">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb13-84">        train_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.DataLoader(train_dataset, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bs, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_workers, pin_memory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-85">        test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.DataLoader(test_dataset, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bs, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_workers, pin_memory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-86"></span>
<span id="cb13-87">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> model, tokz, train_loader, test_loader</span>
<span id="cb13-88"></span>
<span id="cb13-89"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> equal_class_sampling(input_features, target_labels, num_samples):</span>
<span id="cb13-90">    num_classes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(target_labels.unique())</span>
<span id="cb13-91">    num_samples_per_class <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> num_classes</span>
<span id="cb13-92">    dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input'</span>: input_features, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>: target_labels})</span>
<span id="cb13-93">    grouped <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dataset.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>])</span>
<span id="cb13-94">    sampled_elements <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> grouped.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x.sample(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(num_samples_per_class, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x))))</span>
<span id="cb13-95">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sampled_elements[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input'</span>], sampled_elements[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span></code></pre></div>
</details>
</div>
</section>
<section id="training" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="training">Training</h2>
<section id="evaluations" class="level3">
<h3 class="anchored" data-anchor-id="evaluations">Evaluations</h3>
<p>To evaluate our model, we will primarily use recall and a custom metric that we will call F2. Recall measures the ability of the model to correctly identify all relevant instances (true positives) from the dataset and is calculated as TP/(TP + FN), where TP stands for true positives and FN stands for false negatives.</p>
<p>The custom metric, F2, is designed to provide a more comprehensive evaluation of the modelâ€™s performance by balancing the detection of the positive class and minimizing errors. The F2 score is calculated as TP/(TP + FN + FP), where FP stands for false positives. This metric helps evaluate the modelâ€™s capacity to detect the positive class correctly while accounting for both false negatives and false positives. By considering both types of errors, the F2 metric ensures that the model is not only identifying positive instances accurately but also minimizing the incorrect classification of negative instances as positive. This balanced approach provides a more nuanced assessment of the modelâ€™s overall effectiveness.</p>
<hr>
</section>
<section id="modeling" class="level3">
<h3 class="anchored" data-anchor-id="modeling">Modeling</h3>
<p>For simplicityâ€™s sake, Iâ€™ll use the distill version of Camembert model here, but youâ€™re free to use any of the models below.</p>
<div id="cell-29" class="cell" data-execution="{&quot;iopub.status.busy&quot;:&quot;2024-05-16T22:48:47.588511Z&quot;,&quot;iopub.execute_input&quot;:&quot;2024-05-16T22:48:47.588779Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-05-16T22:48:47.597717Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-05-16T22:48:47.588757Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-05-16T22:48:47.596859Z&quot;}" data-trusted="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">models <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb14-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bert'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bert-base-uncased"</span>,</span>
<span id="cb14-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gpt'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distilgpt2"</span>,</span>
<span id="cb14-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'flau'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"flaubert/flaubert_base_uncased"</span>,</span>
<span id="cb14-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cmb'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cmarkea/distilcamembert-base"</span>,</span>
<span id="cb14-6">}</span></code></pre></div>
</div>
</section>
<section id="fine-tuning" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="fine-tuning">Fine tuning</h3>
<p>The next code might look a bit confusing at first, but letâ€™s break it down step by step.</p>
<p>What weâ€™re doing here is creating smaller subsets from our original training and test sets to build training, validation and test samples.</p>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab the 'message' and 'target' columns from the training set and store them in X_train and y_train</span></span>
<span id="cb15-2">X_train, y_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span>], train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span></code></pre></div>
</div>
<p>Next, we split off a small portion of the original test set to use as our validation set. This is like keeping a small piece of pie aside before sharing the rest.</p>
<div id="cell-34" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">X_valid_sample, X_valid, y_valid_sample, y_valid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(test[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span>], test[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>], test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb16-2">X_valid_sample.shape, X_valid.shape, y_valid_sample.shape, y_valid.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>((9357,), (177783,), (9357,), (177783,))</code></pre>
</div>
</div>
<p>Then, we balance our training data. Imagine we have 6000 rows, and we want to make sure we have an equal number of positive and negative samplesâ€”3000 of each.</p>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">X_train_sample, y_train_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> equal_class_sampling(X_train, y_train, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6000</span>)</span></code></pre></div>
</div>
<p>Finally, we take another small slice of the test set to build our final test sample. Think of this as taking a tiny bit more of that pie for a taste test.</p>
<div id="cell-38" class="cell" data-outputid="936648c1-d053-418c-9b07-db17a7070612" data-execution_count="27">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split the remaining validation set to create a small test sample (2% of X_valid and y_valid)</span></span>
<span id="cb19-2">_, X_test_sample, _, y_test_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(X_valid, y_valid, test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb19-3">X_test_sample.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(3556,)</code></pre>
</div>
</div>
<p>By doing this, we ensure our model has balanced and representative data for training, validation, and final testing.</p>
<p>Now, we train, we validate and evaluate the model on the test set.</p>
<div id="cell-fig-cap-margin" class="cell page-columns page-full" data-outputid="04235890-1b1e-407a-ea6c-50bea8b53f85" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize an empty dictionary to store training and evaluation history.</span></span>
<span id="cb21-2">BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the batch size for data loaders.</span></span>
<span id="cb21-3">LEARNING_RATE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the learning rate for the optimizer.</span></span>
<span id="cb21-4">weight_decay <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the weight decay (L2 regularization) for the optimizer.</span></span>
<span id="cb21-5">EPOCHS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the number of epochs for training.</span></span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare the dataset dictionary with training and testing samples.</span></span>
<span id="cb21-8">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_train'</span>: X_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_train'</span>: y_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_test'</span>: X_test_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_test'</span>: y_test_sample}</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the model, tokenizer, training data loader, and testing data loader.</span></span>
<span id="cb21-11">model, tokz, train_loader, test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_loader(models[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cmb'</span>], data, bs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>BATCH_SIZE, use_special_pad_token<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb21-12"></span>
<span id="cb21-13">model.to(device)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Move the model to the specified device (CPU or GPU).</span></span>
<span id="cb21-14"></span>
<span id="cb21-15">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Record the start time for training.</span></span>
<span id="cb21-16">train_model(model, train_loader, test_loader, history, num_epochs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>EPOCHS, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LEARNING_RATE, early_stopping_patience<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, weight_decay<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>weight_decay)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model.</span></span>
<span id="cb21-17">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Record the end time for training.</span></span>
<span id="cb21-18">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the execution time for training.</span></span>
<span id="cb21-19"></span>
<span id="cb21-20">clear_output()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear the output (useful in Jupyter notebooks to clear previous outputs).</span></span>
<span id="cb21-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the execution time for training.</span></span>
<span id="cb21-22"></span>
<span id="cb21-23">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Record the start time for evaluation.</span></span>
<span id="cb21-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evaluate the model on the validation dataset and optionally plot the training history.</span></span>
<span id="cb21-25">evaluate_model(tokz, model, (X_valid_sample, y_valid_sample), history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, plot_train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb21-26">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Record the end time for evaluation.</span></span>
<span id="cb21-27">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the execution time for evaluation.</span></span>
<span id="cb21-28"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the execution time for evaluation.</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Execution time: 363.3319444656372 seconds</code></pre>
</div>
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-cap-margin" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-cap-margin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm_files/figure-html/fig-cap-margin-output-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-cap-margin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Series of graphs depicting the performance metrics of the model. The metrics include Training Loss, Accuracy, Precision, Recall, and F2 score for both training and testing data.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Metrics:
  Eval Accuracy: 0.6475366036122688
  Eval Precision: 0.23312101910828026
  Eval Recall: 0.7605985037406484
  Eval F2: 21.7184903868977
Execution time: 84.7105667591095 seconds</code></pre>
</div>
</div>
<p>Based on the performance of the model on two epochs, we can make the following analysis:</p>
<ol type="1">
<li><strong>Training Loss</strong>: Decreases from approximately 0.55 to 0.45, indicating improved performance during training.</li>
<li><strong>Accuracy</strong>: Shows a significant increase for training accuracy from about 0.70 to 0.78, while test accuracy slightly improves from around 0.62 to 0.64.</li>
<li><strong>Precision</strong>: Training precision rises from about 0.75 to 0.80, whereas test precision remains almost constant at around 0.21.</li>
<li><strong>Recall</strong>: Training recall increases from 0.60 to 0.75, while test recall decreases from 0.85 to 0.70, suggesting potential overfitting.</li>
<li><strong>F2</strong>: Indicates a decline in the F2 score from approximately 21.2 to 20.2, which means that the model is not generalizing from the training data to the test data.</li>
</ol>
<section id="test-metrics" class="level6">
<h6 class="anchored" data-anchor-id="test-metrics">Test Metrics:</h6>
<ol type="1">
<li><strong>Eval Accuracy</strong>: 0.6475, which indicates the modelâ€™s ability to correctly predict test data is moderate but lower compared to training accuracy.</li>
<li><strong>Eval Precision</strong>: 0.2331, which is significantly lower than the training precision, suggesting the model struggles with false positives on the test set.</li>
<li><strong>Eval Recall</strong>: 0.7606, which is relatively high and close to the training recall, showing the model still performs well in identifying most positive instances on the test set.</li>
<li><strong>Eval F2</strong>: 21.7185, which remains high, indicating that despite high recall, the model struggles with false positives.</li>
</ol>
</section>
<section id="conclusion" class="level6">
<h6 class="anchored" data-anchor-id="conclusion">Conclusion:</h6>
<ul>
<li><strong>Overfitting</strong>: The discrepancy between training and test precision suggests overfitting. The model performs well on the training data but struggles with generalization, leading to lower performance on unseen data.</li>
<li><strong>F2 score</strong>: The model prioritizes recall over precision. This is evident from the high recall but low precision on the test set. This behavior is further reflected in the F2 score, which is low, indicating many false positives.</li>
</ul>
<p>This analysis suggest that there is a problem with our model, because we need a model that should perform well on unseen data with low errors.</p>
</section>
<section id="why-is-this-important" class="level6">
<h6 class="anchored" data-anchor-id="why-is-this-important">Why is this important?</h6>
<p>Well, imagine that we will deploy our model in a real-world application. We donâ€™t want to miss comments that might receive a response because we could use them to increase traffic on our site or social media. In that case, a model that detects positive instances well with minimal false positives is acceptable. However, our model currently has many false positives, which can be problematic.</p>
</section>
<section id="practical-implications" class="level6 page-columns page-full">
<h6 class="anchored" data-anchor-id="practical-implications">Practical Implications:</h6>
<ul>
<li>Business Impact: If the model is used in an application like content moderation or customer feedback analysis, high false positives mean that many irrelevant comments would be flagged for response. This can lead to inefficient use of resources and missed opportunities to engage with truly relevant comments.</li>
<li>User Experience: In applications like spam detection, a high number of false positives can frustrate users, as legitimate messages may be incorrectly flagged as spam.</li>
<li>Operational Efficiency: For customer service applications, responding to false positives wastes time and effort that could be better spent addressing genuine issues.</li>
</ul>
<p>But, letâ€™s try with more data in our training set to see the impact on the model performance. We will initialise a new model and train it on 10000 comments.</p>
<div id="cell-43" class="cell" data-outputid="af75dd9b-263b-4e8b-c489-9a39062f9e47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">X_train, y_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span>], train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span>
<span id="cb24-2">X_train_sample, y_train_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> equal_class_sampling(X_train, y_train, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb24-3">_, X_test_sample, _, y_test_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(X_valid, y_valid, test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span></code></pre></div>
</details>
</div>
<div id="cell-fig-cap-margin2" class="cell page-columns page-full" data-outputid="ded74fd0-2a4a-42d1-e16d-ec39b5198250" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb25-2">BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb25-3">LEARNING_RATE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span></span>
<span id="cb25-4">weight_decay <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span></span>
<span id="cb25-5">EPOCHS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb25-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_train'</span>: X_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_train'</span>: y_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_test'</span>: X_test_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_test'</span>: y_test_sample}</span>
<span id="cb25-7">model, tokz, train_loader, test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_loader(models[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cmb'</span>], data, bs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>BATCH_SIZE, use_special_pad_token<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb25-8">model.to(device)</span>
<span id="cb25-9"></span>
<span id="cb25-10">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb25-11">train_model(model, train_loader, test_loader, history, num_epochs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>EPOCHS, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LEARNING_RATE, early_stopping_patience<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, weight_decay<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>weight_decay)</span>
<span id="cb25-12">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb25-13">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb25-14"></span>
<span id="cb25-15">clear_output()</span>
<span id="cb25-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span>
<span id="cb25-17"></span>
<span id="cb25-18">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb25-19">evaluate_model(tokz, model, (X_valid_sample, y_valid_sample), history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, plot_train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-20">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb25-21">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb25-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Execution time: 1122.6102643013 seconds</code></pre>
</div>
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-cap-margin2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-cap-margin2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm_files/figure-html/fig-cap-margin2-output-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-cap-margin2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Series of graphs depicting the performance metrics of the model. The metrics include Training Loss, Accuracy, Precision, Recall, and F2 score for both training and testing data.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Metrics:
  Eval Accuracy: 0.6856898578604254
  Eval Precision: 0.25793871866295265
  Eval Recall: 0.769742310889443
  Eval F2: 23.946211533488494
Execution time: 84.70709776878357 seconds</code></pre>
</div>
</div>
<p>The F2 score improved from 21% to 23%. But can we conclude that itâ€™s the increased training set that induces these results?</p>
<p>Letâ€™s try it with a larger training set.</p>
<div id="cell-46" class="cell" data-outputid="2c81ea7b-c84f-4e90-aed8-3d1922e1fefe">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">X_train, y_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span>], train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span>
<span id="cb28-2">X_train_sample, y_train_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> equal_class_sampling(X_train, y_train, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15000</span>)</span>
<span id="cb28-3">_, X_test_sample, _, y_test_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(X_valid, y_valid, test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span></code></pre></div>
</details>
</div>
<div id="cell-fig-cap-margin3" class="cell page-columns page-full" data-outputid="76cc62cb-0659-475d-a63c-fe92852e4214" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb29-2">BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb29-3">LEARNING_RATE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span></span>
<span id="cb29-4">weight_decay <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span></span>
<span id="cb29-5">EPOCHS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb29-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_train'</span>: X_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_train'</span>: y_train_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X_test'</span>: X_test_sample, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y_test'</span>: y_test_sample}</span>
<span id="cb29-7">model, tokz, train_loader, test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_loader(models[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cmb'</span>], data, bs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>BATCH_SIZE, use_special_pad_token<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb29-8">model.to(device)</span>
<span id="cb29-9"></span>
<span id="cb29-10">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb29-11">train_model(model, train_loader, test_loader, history, num_epochs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>EPOCHS, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LEARNING_RATE, early_stopping_patience<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, weight_decay<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>weight_decay)</span>
<span id="cb29-12">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb29-13">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb29-14"></span>
<span id="cb29-15">clear_output()</span>
<span id="cb29-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span>
<span id="cb29-17"></span>
<span id="cb29-18">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb29-19">evaluate_model(tokz, model, (X_valid_sample, y_valid_sample), history, device, bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BATCH_SIZE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, plot_train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb29-20">end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb29-21">execution_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb29-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Execution time:"</span>, execution_time, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Execution time: 1914.5363965034485 seconds</code></pre>
</div>
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-cap-margin3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-cap-margin3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm_files/figure-html/fig-cap-margin3-output-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-cap-margin3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Series of graphs depicting the performance metrics of the model. The metrics include Training Loss, Accuracy, Precision, Recall, and F2 score for both training and testing data.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Metrics:
  Eval Accuracy: 0.7079192048733568
  Eval Precision: 0.26705237515225333
  Eval Recall: 0.7290108063175395
  Eval F2: 24.293628808864266
Execution time: 85.33442664146423 seconds</code></pre>
</div>
</div>
<p>On test set, the F2 score of the model improve again from 23% to 24%.</p>
</section>
<section id="conclusion-1" class="level6">
<h6 class="anchored" data-anchor-id="conclusion-1">Conclusion:</h6>
<p>The increase in the training set size helps the model generalize better to the test data, reducing overfitting and improving its ability to balance precision and recall effectively.</p>
</section>
</section>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<ol type="1">
<li><p><strong>Dataset Analysis is Crucial</strong>: Always begin by analyzing your dataset. Understanding the distribution and characteristics of your data helps in making informed decisions about model training and evaluation. In scenarios with limited resources, generating more data for the underrepresented class might not be feasible. Instead, sampling equal numbers of comments from each class for the training set can help reduce bias towards the overrepresented class.</p></li>
<li><p><strong>Balanced Training, Unbalanced Validation</strong>: While balancing the training set by equal sampling is important to reduce bias, the validation set should remain unbalanced. This approach ensures that the modelâ€™s performance is evaluated in a realistic manner, reflecting its ability to generalize to the true distribution of the data.</p></li>
<li><p><strong>Resource-Based Training Strategy</strong>: Define your training strategy based on the available resources. When computational power or time is limited, working with a smaller, balanced sample of the dataset is a practical approach. This allows for iterative experimentation and tuning without the overhead of processing the entire dataset.</p></li>
<li><p><strong>Problem-Specific Metrics</strong>: Choose evaluation metrics that align with your problemâ€™s objectives. For instance, in this scenario, the F2 score (F2 = tp / (tp + 2 * fn + fp)) is used to evaluate model performance by balancing the detection of the positive class and minimizing errors.</p></li>
<li><p><strong>Initial Model Performance</strong>: After the first round of training, the F2 score indicates that the model prioritizes recall over precision. This is evidenced by the high recall but low precision on the test set.</p></li>
<li><p><strong>Impact of False Positives</strong>: High false positives can be problematic in real-world applications. They can lead to inefficient use of resources and missed opportunities to engage with truly relevant comments. This highlights the need for a balance between precision and recall.</p></li>
<li><p><strong>Training Set Size and Generalization</strong>: Increasing the size of the training set helps the model generalize better to the test data. A larger training set reduces overfitting and enhances the modelâ€™s ability to balance precision and recall effectively. This results in improved overall performance and more reliable predictions.</p></li>
<li><p><strong>Choosing the Right Model</strong>: Select a model that is suitable for your specific problem. For instance, since the dataset consists of French text, using CamemBERT, a model specifically designed for the French language, is an appropriate choice.</p></li>
<li><p><strong>Hyperparameter Tuning</strong>: Finding the optimal hyperparameters for your model is crucial and often involves extensive experimentation. Before finalizing the model, numerous combinations were tested to identify the best-performing configuration. Hyperparameter tuning is more of an art than a strict recipe, requiring intuition and experience to achieve the best results.</p></li>
</ol>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a> ]]></description>
  <category>Tutorial</category>
  <guid>https://amenalahassa.github.io/amenalahassa/posts/predicting_comment_reply_llm.html</guid>
  <pubDate>Tue, 21 May 2024 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
